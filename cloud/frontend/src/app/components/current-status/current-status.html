<div class="view-header">
    <h2>Current Status</h2>
    <div class="view-actions">
        <span class="timestamp">{{ lastUpdated | date:'short' }}</span>
        <button (click)="refresh()" [disabled]="loading">Refresh â†»</button>
    </div>
</div>

<div class="agent-health-banner" [ngClass]="{
  'status-healthy': agentStatus === 'HEALTHY',
  'status-degraded': agentStatus === 'DEGRADED',
  'status-offline': agentStatus === 'OFFLINE',
  'status-unknown': agentStatus === 'UNKNOWN'
}">
  <div *ngIf="agentHealthData.length > 0">
    <span class="status-icon">
      {{ agentStatus === 'HEALTHY' ? 'âœ…' :
         agentStatus === 'DEGRADED' ? 'âš ï¸' :
         agentStatus === 'OFFLINE' ? 'ğŸ”´' : 'â“' }}
    </span>
    <span class="status-text">
      Agent {{ agentHealthData[0].siteId }} - {{ agentStatus }}
    </span>
    <span class="status-time">
      Last heartbeat: {{ agentLastSeen }}
    </span>
  </div>
  <div *ngIf="agentHealthData.length === 0">
    <span class="status-icon">â“</span>
    <span class="status-text">No agent data available</span>
  </div>
</div>


<div *ngIf="downtimes.length > 0" class="downtime-banner">
    <span class="warning-icon">âš ï¸</span>
    <div class="downtime-text">
        <strong>Agent offline today:</strong>
        <span *ngFor="let dt of downtimes; let last = last">
            {{ formatDowntime(dt) }}<span *ngIf="!last">, </span>
        </span>
        <p class="downtime-note">Presence data may be incomplete during these periods.</p>
    </div>
</div>


<div *ngIf="loading" class="loading">Loading...</div>
<div *ngIf="error" class="error">{{ error }}</div>
<div *ngIf="!loading && !error" class="employee-grid">
    <div *ngFor="let emp of employees" class="employee-card">
        <div class="employee-header">
            <span class
                  None="emp.isPresent ? 'status-indicator status-online' : 'status-indicator status-offline'">
                {{ emp.isPresent ? 'ğŸŸ¢' : 'ğŸ”´' }}
            </span>
            <h3>{{ emp.employeeName }}</h3>
        </div>
        <div class="employee-details">
            <p *ngIf="emp.isPresent">Present since {{ formatTime(emp.lastSeen) }}</p>
            <p *ngIf="!emp.isPresent">Last seen {{ formatTime(emp.lastSeen) }}</p>
            <p class="area">Area: {{ emp.currentArea }}</p>
        </div>
    </div>
</div>
