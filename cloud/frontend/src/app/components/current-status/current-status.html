<div class="view-header">
    <h2>Current Status</h2>
    <div class="view-actions">
        <span class="timestamp">{{ lastUpdated | date:'MM/dd/yyyy, HH:mm' }}</span>
        <button (click)="refresh()" [disabled]="loading">Refresh ↻</button>
    </div>
</div>

<div class="agent-health-banner" *ngIf="agentHealthData.length > 0" [ngClass]="{
  'banner-healthy': agentStatus === 'HEALTHY',
  'banner-degraded': agentStatus === 'DEGRADED',
  'banner-offline': agentStatus === 'OFFLINE',
  'banner-unknown': agentStatus === 'UNKNOWN'
}">
  <div class="status-badge-agent">{{ agentStatus }}</div>
  <div class="banner-content">
    <div class="banner-left">
      <div class="status-info">
        <span class="site-name">{{ agentHealthData[0].siteId }}</span>
        <span class="status-label">{{ agentStatus }}</span>
      </div>
    </div>
    <div class="banner-right">
      <span class="heartbeat-label">Last heartbeat:</span>
      <span class="heartbeat-time">{{ agentLastSeen }}</span>
    </div>
  </div>
</div>

<div class="agent-health-banner banner-unknown" *ngIf="agentHealthData.length === 0">
  <div class="banner-content">
    <span class="status-icon">❓</span>
    <span class="status-text">No agent data available</span>
  </div>
</div>

<div *ngIf="downtimes.length > 0" class="downtime-banner">
    <span class="warning-icon">⚠️</span>
    <div class="downtime-text">
        <strong>Agent offline today:</strong>
        <span *ngFor="let dt of downtimes; let last = last">
            {{ formatDowntime(dt) }}<span *ngIf="!last">, </span>
        </span>
        <p class="downtime-note">Presence data may be incomplete during these periods.</p>
    </div>
</div>


<h3>Employee Status</h3>
<div *ngIf="loading" class="loading">Loading...</div>
<div *ngIf="error" class="error">{{ error }}</div>
<div *ngIf="!loading && !error" class="employee-grid">
    <div *ngFor="let emp of employees" class="employee-card" [ngClass]="emp.isPresent ? 'online' : 'offline'">
        <div class="status-badge">
        {{ emp.isPresent ? 'ONLINE' : 'OFFLINE' }}
        </div>
        <div class="card-layout">
            <div class="card-right">
                <p class="name">{{ emp.employeeName }}</p>
                <p class="time">Activity: {{ formatTime(emp.lastSeen) }}</p>
                <p class="area">Area: {{ emp.currentArea }}</p>
            </div>
        </div>
    </div>
</div>
